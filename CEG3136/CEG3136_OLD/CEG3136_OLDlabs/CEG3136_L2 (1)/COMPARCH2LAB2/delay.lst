D:\OneDrive\Fall 2017\CEG 3136 COMPUTER ARCHITECTURE II\CEG3136 COMP. ARCH. II Labs\L2\CODE\delay.lst - generated by MGTEK Assembler ASM12 V1.26 Build 144 for WIN32 (x86) - Thu Oct 05 05:02:02 2017

    1:                                 ;------------------------------------------------------
    2:                                 ; Alarm System Simulation Assembler Program
    3:                                 ; File: delay.asm
    4:                                 ; Description: The Delay Module
    5:                                 ; Author: 
    6:                                 ; Date: 
    7:                                 ;------------------------------------------------------
    8:                                 
    9:                                 ; Some definitions
D:\OneDrive\Fall 2017\CEG 3136 COMPUTER ARCHITECTURE II\CEG3136 COMP. ARCH. II Labs\L2\CODE\delay.asm(10): Error A2027: col(2) 'count': unknown mnemonic or pseudo command
   10:                                         COUNT equ 3000
D:\OneDrive\Fall 2017\CEG 3136 COMPUTER ARCHITECTURE II\CEG3136 COMP. ARCH. II Labs\L2\CODE\delay.asm(11): Error A2063: col(9) 'code_section': section not defined
   11:                                         SWITCH code_section
   12:                                 
   13:                                 ;-------------------------------
   14:                                 ; Subroutine delayms
   15:                                 ; Parameters: num - number of milliseconds to delay - in accumulator D
   16:                                 ; Returns: nothing
   17:                                 ; Global Variables:
   18:                                 ; Description: Delays for num ms. 
   19:                                 ;--------------------------------
   20:                                 ; Stack Usage:
   21:                                         OFFSET 0  ; to setup offset into stack
   22:     0000 +0002                  DMS_RA     DS.W 1 ; return address
   23:                                 
   24:     0002                        delayms:
   25:     0002                        delayms_while:;do{
   26:     0000 17 1C                          jsr delay1ms; dealy1ms();
   27:     0002 04 34 FD                       dbne d, delayms_while;num--;}while(num!=0);
   28:     0005 3D                             rts
   29:                                         
   30:                                 ;------------------------------------------------------
   31:                                 ; Subroutine setDelay
   32:                                 ; Parameters: cnt - accumulator D
   33:                                 ; Returns: nothing
   34:                                 ; Global Variables: delayCount
   35:                                 ; Description: Intialises the delayCount 
   36:                                 ;              variable.
   37:                                 ;------------------------------------------------------
   38:     0006                        setDelay: 
   39:     0006 5C 26                          std delayCount ; delayCount = counter  
   40:     0008 3D                             rts     
   41:                                 
   42:                                 ;------------------------------------------------------
   43:                                 ; Subroutine: polldelay
   44:                                 ; Parameters:  none
   45:                                 ; Returns: TRUE when delay counter reaches 0 - in accumulator A
   46:                                 ; Local Variables
   47:                                 ;   retval - acc A 
   48:                                 ;   retval 
   49:                                 ; Global Variables:
   50:                                 ;      delayCount
   51:                                 ; Description: The subroutine delays for 1 ms, decrements delayCount.
   52:                                 ;              If delayCount is zero, return TRUE; FALSE otherwise.
   53:                                 ;   Core Clock is set to 24 MHz, so 1 cycle is 41 2/3 ns
   54:                                 ;   NOP takes up 1 cycle, thus 41 2/3 ns
   55:                                 ;   Need 24 cyles to create 1 microsecond delay
   56:                                 ;   8 cycles creates a 333 1/3 nano delay
   57:                                 ;       DEX - 1 cycle
   58:                                 ;       BNE - 3 cyles - when branch is taken
   59:                                 ;       Need 4 NOP
   60:                                 ;   Run Loop 3000 times to create a 1 ms delay   
   61:                                 ;------------------------------------------------------
   62:                                 ; Stack Usage:
   63:                                         OFFSET 0  ; to setup offset into stack
   64:     0000 +0001                  PDLY_RETVAL DS.B 1; 
   65:     0001                        PDLY_VARSIZE:
   66:     0001 +0002                  PDLY_PR_Y   DS.W 1 ; preserve Y register
   67:     0003 +0002                  PDLY_RA     DS.W 1 ; return address
   68:                                 
   69:     0009 35                     polldelay: pshy  
   70:     000A 1B 9F                          leas -PDLY_VARSIZE,SP
D:\OneDrive\Fall 2017\CEG 3136 COMPUTER ARCHITECTURE II\CEG3136 COMP. ARCH. II Labs\L2\CODE\delay.asm(71): Error A2038: col(13) 'fasle': undefined symbol
   71:                                         movb #FASLE,PDLY_RETVAL,SP ; byte retval = FALSE;
   72:     000C 17 1C                          jsr delay1ms               ; delay1ms(); 
   73:     000E 73 0026                        dec delayCount             ; delayCount--; 
   74:     0011 F7 0026                        tst delayCount             ;if (delayCount==0)
   75:     0014 26 00                          bne polldelay_endif        ; 
D:\OneDrive\Fall 2017\CEG 3136 COMPUTER ARCHITECTURE II\CEG3136 COMP. ARCH. II Labs\L2\CODE\delay.asm(76): Error A2038: col(12) 'true': undefined symbol
   76:                                         movb #TRUE,PDLY_RETVAL,SP ; retval = TRUE;
   77:     0016                                polldelay_endif: 
   78:     0016 A6 80                          ldaa PDLY_RETVAL,SP
   79:                                         ; restore registers and stack 
   80:     0018 1B 9F                          leas -PDLY_VARSIZE,SP 
   81:     001A 31                             puly   
   82:     001B 3D                             rts  
   83:                                 
   84:                                 ;------------------------------------------------------
   85:                                 ; Subroutine: delay1ms
   86:                                 ; Parameters:  none
   87:                                 ; Returns: none
   88:                                 ; Local Variables
   89:                                 ;   
   90:                                 ; Global Variables:
   91:                                 ;      COUNT - Number of loops -in register X
   92:                                 ; Description: 
   93:                                 ;   The subroutine delays for 1 ms.
   94:                                 ;   Core Clock is set to 24 MHz, so 1 cycle is 41 2/3 ns
   95:                                 ;   NOP takes up 1 cycle, thus 41 2/3 ns
   96:                                 ;   Need 24 cyles to create 1 microsecond delay
   97:                                 ;   8 cycles creates a 333 1/3 nano delay
   98:                                 ;       DEX - 1 cycle
   99:                                 ;       BNE - 3 cyles - when branch is taken
  100:                                 ;       Need 4 NOP
  101:                                 ;   Run Loop 3000 times to create a 1 ms delay   
  102:                                 ;------------------------------------------------------
  103:                                 ; Stack Usage:
  104:                                         OFFSET 0  ; to setup offset into stack
  105:     0000                        D1MS_VARSIZE:
  106:     0000 +0002                  D1MS_PR_X   DS.W 1 ; preserve X
  107:                                 
  108:     001C 34                     delay1ms:pshx
D:\OneDrive\Fall 2017\CEG 3136 COMPUTER ARCHITECTURE II\CEG3136 COMP. ARCH. II Labs\L2\CODE\delay.asm(109): Error A2038: col(12) 'count': undefined symbol
  109:                                         ldx #COUNT    ;cnt = COUNT
  110:     001D                                delay1ms_loop:; do 
  111:     001D A7                             NOP           ;{
  112:     001E A7                             NOP                             ;                       
  113:     001F A7                             NOP                             ;
  114:     0020 A7                             NOP            ; 
  115:     0021 09                             DEX            ; cnt--
  116:     0022 26 F9                          bne delay1ms_loop;}while(cnt!=0)
  117:                                         ; restore registers   
  118:     0024 30                             pulx
  119:     0025 3D                             rts
  120:                                 
  121:                                 ;------------------------------------------------------
  122:                                 ; Global variables
  123:                                 ;------------------------------------------------------
D:\OneDrive\Fall 2017\CEG 3136 COMPUTER ARCHITECTURE II\CEG3136 COMP. ARCH. II Labs\L2\CODE\delay.asm(124): Error A2063: col(11) 'globalvar': section not defined
  124:                                    switch globalVar
  125:     0026 +0002                  delayCount ds.w 1   ; 2 byte delay counter
  126:                                 

Symbols:
count                           ?00000000
delay1ms                        *0000001c
delay1ms_loop                   *0000001d
delaycount                      *00000026
delayms_while                   *00000002
fasle                           ?00000000
pdly_retval                     *00000000
pdly_varsize                    *00000001
polldelay_endif                 *00000016
true                            ?00000000

